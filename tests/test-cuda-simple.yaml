apiVersion: v1
kind: Pod
metadata:
  name: cuda-device-test-cdi
  namespace: default
spec:
  restartPolicy: Never
  containers:
  - name: cuda-test
    image: nvidia/cuda:12.8.1-devel-ubuntu24.04
    imagePullPolicy: IfNotPresent
    command: ["/bin/bash", "-c"]
    args:
      - |
        echo "=== CUDA Device Test with CDI Annotations ==="
        echo ""
        echo "CUDA_VISIBLE_DEVICES: ${CUDA_VISIBLE_DEVICES:-not set}"
        echo "NVIDIA_VISIBLE_DEVICES: ${NVIDIA_VISIBLE_DEVICES:-not set}"
        echo ""
        echo "All CUDA/NVIDIA environment variables:"
        env | grep -i "cuda\|nvidia" | sort
        echo ""
        echo "Device Files:"
        ls -la /dev/nvidia* 2>/dev/null || echo "No NVIDIA devices found"
        echo ""
        echo "nvidia-smi output:"
        nvidia-smi -L 2>&1 || echo "nvidia-smi failed"
        echo ""
        nvidia-smi --query-gpu=index,uuid,name --format=csv 2>&1 || echo "nvidia-smi query failed"
        echo ""
        echo "Test completed"
    resources:
      limits:
        nvidia.com/gpu: "1"
    securityContext:
      allowPrivilegeEscalation: false
  nodeSelector:
    kubernetes.io/hostname: gpu1
